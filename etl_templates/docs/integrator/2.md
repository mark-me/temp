# Documentatie: DAG (Directed Acyclic Graph) Integratie en Rapportage

## Overzicht

Dit project bevat een set Python-modules voor het bouwen, analyseren, implementeren en visualiseren van Directed Acyclic Graphs (DAG's) die ETL-processen (Extract, Transform, Load) representeren. De belangrijkste componenten zijn:

- **DagBuilder**: Bouwt en beheert de basisstructuur van de DAG op basis van RETW-bestanden, entiteiten en mappings.
- **DagImplementation**: Breidt DagBuilder uit met functionaliteit voor uitvoeringsvolgorde, deadlock-preventie en mapping-implementatie.
- **DagReporting**: Breidt DagImplementation uit met rapportage- en visualisatiefuncties, zoals het genereren van interactieve HTML-visualisaties van de DAG.

## Belangrijkste Klassen en Functionaliteiten

### DagBuilder

- **Doel**: Genereert en beheert de basis-DAG die het ETL-proces beschrijft.
- **Functionaliteiten**:
  - Inlezen van RETW-bestanden en extraheren van entiteiten en mappings.
  - Bouwen van een igraph-graaf met knopen (entiteiten, mappings, bestanden) en randen (afhankelijkheden).
  - Bepalen van uitvoeringsvolgorde en afhankelijkheden.
  - Genereren van subgrafen voor specifieke bestanden of entiteiten.

### DagImplementation

- **Doel**: Verrijkt de basis-DAG met implementatie-informatie, zoals run-levels en deadlock-preventie.
- **Functionaliteiten**:
  - Bepalen van de juiste uitvoeringsvolgorde van mappings.
  - Toewijzen van stages aan mappings om gelijktijdige uitvoering zonder conflicten mogelijk te maken.
  - Genereren van een gesorteerde lijst van mappings voor deployment.

### DagReporting

- **Doel**: Visualisatie en rapportage van de DAG en zijn afhankelijkheden.
- **Functionaliteiten**:
  - Omzetten van igraph naar networkx voor visualisatie.
  - Genereren van interactieve HTML-visualisaties van de volledige DAG, subgrafen, afhankelijkheden en entiteitstrajecten.
  - Instellen van visuele attributen (kleur, vorm, tooltip) voor knopen.
  - Classificeren van knopen op basis van positie (START, INTERMEDIATE, END).
  - Rapporteren van entiteiten zonder definitie.

## Visualisatie

De module maakt gebruik van **pyvis** en **networkx** om interactieve netwerkvisualisaties te genereren. Knopen worden visueel onderscheiden op basis van type, model en positie in de hiÃ«rarchie. De visualisaties worden als HTML-bestanden opgeslagen en zijn geschikt voor analyse en presentatie.

## Voorbeeldgebruik

```python
from integrator.dag_reporting import DagReporting

# Bouw en visualiseer de ETL-DAG
dag = DagReporting()
dag.build_dag(files_RETW=["bestand1.json", "bestand2.json"])
dag.plot_etl_dag(file_html="output/etl_dag.html")
```

## Belangrijke Concepten

* **RETW-bestand**: Een JSON-bestand met entiteiten, mappings en modellen die de basis vormen voor de DAG.
* **Entiteit**: Een knoop in de DAG die een data-object representeert.
* **Mapping**: Een knoop die een transformatie of relatie tussen entiteiten beschrijft.
* **Run-level**: Het niveau waarop een mapping wordt uitgevoerd, gebaseerd op afhankelijkheden.
* **Deadlock-preventie**: Mechanisme om gelijktijdige uitvoering van mappings zonder conflicten te garanderen.

## Afhankelijkheden

* [igraph](https://igraph.org/python/)
* [networkx](https://networkx.org/)
* [pyvis](https://pyvis.readthedocs.io/)
* [jinja2](https://jinja.palletsprojects.com/)
* [logtools](#Logtools.md)
